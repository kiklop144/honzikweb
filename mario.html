<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini Kart Racer 3D</title>
<style>
body { margin:0; background:black; color:white; font-family:sans-serif; text-align:center; }
canvas { display:block; margin:auto; background:#87ceeb; }
#menu {
  position:absolute; inset:0;
  background:rgba(0,0,0,0.85);
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  gap:12px;
}
button, select { font-size:18px; padding:8px; }
</style>
</head>
<body>

<div id="menu">
  <h1>Mini Kart Racer 3D</h1>
  <select id="difficulty">
    <option value="easy">Easy</option>
    <option value="medium" selected>Medium</option>
    <option value="hard">Hard</option>
  </select>
  <button id="start">Start</button>
  <p>↑ Accelerate • ↓ Brake • ← → Steer</p>
</div>

<canvas id="c" width="900" height="600"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const keys = {};
addEventListener("keydown", e => keys[e.code]=true);
addEventListener("keyup", e => keys[e.code]=false);

const ROAD_WIDTH = 2000;
const SEGMENTS = [];
const SEG_LEN = 200;
const TOTAL_LAPS = 3;

for(let i=0;i<300;i++){
  SEGMENTS.push({
    curve: Math.sin(i*0.05)*0.6,
    y: Math.sin(i*0.1)*20
  });
}

class Kart {
  constructor(player=false, ai=null){
    this.z = 0;
    this.x = 0;
    this.speed = 0;
    this.maxSpeed = ai ? ai.maxSpeed : 600;
    this.player = player;
    this.ai = ai;
    this.lap = 0;
    this.pos = 0;
  }

  update(dt){
    if(this.player){
      if(keys.ArrowUp) this.speed += 800*dt;
      if(keys.ArrowDown) this.speed -= 1000*dt;
      if(keys.ArrowLeft) this.x -= 600*dt*(this.speed/this.maxSpeed);
      if(keys.ArrowRight) this.x += 600*dt*(this.speed/this.maxSpeed);
    } else {
      this.ai.control(this,dt);
    }

    this.speed = Math.max(0, Math.min(this.speed, this.maxSpeed));
    this.z += this.speed*dt;

    if(this.z > SEGMENTS.length*SEG_LEN){
      this.z -= SEGMENTS.length*SEG_LEN;
      this.lap++;
    }
  }
}

class AI {
  constructor(diff){
    const d = {
      easy:{maxSpeed:500},
      medium:{maxSpeed:600},
      hard:{maxSpeed:700}
    }[diff];
    Object.assign(this,d);
  }

  control(k,dt){
    k.speed += 600*dt;
    k.x += Math.sin(k.z/500)*200*dt;
  }
}

let karts=[];
let last=0;

document.getElementById("start").onclick=()=>{
  document.getElementById("menu").style.display="none";
  startGame();
};

function startGame(){
  karts=[];
  karts.push(new Kart(true));
  for(let i=0;i<3;i++){
    karts.push(new Kart(false,new AI(difficulty.value)));
  }
  last=performance.now();
  requestAnimationFrame(loop);
}

function project(x,y,z){
  const scale = 300/z;
  return {
    x: canvas.width/2 + x*scale,
    y: canvas.height/2 - y*scale,
    w: scale*ROAD_WIDTH
  };
}

function drawRoad(camZ){
  let base = Math.floor(camZ/SEG_LEN);
  let camX = 0;
  let camY = 1500;
  let x=0,dx=0;

  for(let n=0;n<200;n++){
    const seg = SEGMENTS[(base+n)%SEGMENTS.length];
    dx += seg.curve;
    x += dx;

    const p1 = project(x-camX, seg.y-camY, (n)*SEG_LEN);
    const p2 = project(x-camX, seg.y-camY, (n+1)*SEG_LEN);

    ctx.fillStyle = n%2?"#555":"#666";
    ctx.beginPath();
    ctx.moveTo(p1.x-p1.w,p1.y);
    ctx.lineTo(p1.x+p1.w,p1.y);
    ctx.lineTo(p2.x+p2.w,p2.y);
    ctx.lineTo(p2.x-p2.w,p2.y);
    ctx.fill();
  }
}

function loop(t){
  const dt=(t-last)/1000;
  last=t;

  ctx.fillStyle="#87ceeb";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#2d882d";
  ctx.fillRect(0,canvas.height/2,canvas.width,canvas.height/2);

  const player=karts[0];
  drawRoad(player.z);

  karts.forEach(k=>k.update(dt));

  karts.forEach((k,i)=>{
    ctx.fillStyle=i==0?"red":"blue";
    ctx.fillRect(canvas.width/2+k.x*0.05-10,450,20,10);
  });

  ctx.fillStyle="white";
  ctx.fillText(`Lap: ${player.lap+1}/${TOTAL_LAPS}`,20,30);

  requestAnimationFrame(loop);
}
</script>
</body>
</html>
